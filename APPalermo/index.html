<!DOCTYPE html>
<!-- 
    To customize this page for your own data, open fusiontable_settings.js and follow instructions.
    You should not have to touch this file.
-->

<html>
<head>
    <meta name="generator" content="HTML Tidy for Mac OS X (vers 31 October 2006 - Apple Inc. build 15.10), see www.w3.org">
    <meta charset="utf-8">
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <link rel="apple-touch-icon" href="apple-touch-icon.png"/>
    <link rel="icon" type="image/png" href="favicon.ico"/>

    <title>Mobile Fusion Table</title>
    <!-- if updating jQueryMobile, please see MOBILE-FUSION-TABLES comments in current version -->
    <link rel="stylesheet" href="source/jquery.mobile-1.3.1.modified.css" type="text/css"/>

    <script type="text/javascript" src="source/jquery-1.7.2.min.js"></script>
    <script type="text/javascript" src="source/jquery.mobile-1.3.1.modified.js"></script> <!-- this must come after jquery -->
    <script type="text/javascript" src="source/handlebars.js"></script>
    <script type="text/javascript" src="source/jquery.address.min.js"></script>
    <script type="text/javascript" src="https://maps.google.com/maps/api/js?v=3.16.4&sensor=false&amp;libraries=places,geometry"></script>

    <script type="text/javascript" src="source/maps_lib.js"></script>
    <script type="text/javascript" src="fusiontable_settings.js"></script>

    <style type="text/css">
        .infobox-container {
            overflow:hidden;
            position:relative;
            font-weight:normal;
            overflow:auto;
        }

        .infobox-default {
            display:inline;
            font-family: Arial, Helvetica, Geneva, sans-serif;
            white-space:normal;
        }

        /* using hr as spacer between search fields */
        hr { 
            display: block; height: 8px;
            border: 0; margin: 0; padding: 0;
        }

        #map_content {
            padding: 0;
            width: 100%;
            height: 100%;
            overflow: hidden;
        }

        #map_canvas {
            padding: 0;
            text-shadow: none;
        }

        #black {
            background-color: #000;
        }
        
        /* custom icons */
        .ui-icon-location {
            background-image: url(source/images/icons-18-white-location.png);
            background-repeat: no-repeat;
        }
    </style>
</head>

<body id="black">
    <!-- Home -->

    <div data-role="page" id="page-map">
        <div data-theme="a" data-role="header">
    <!-- About button -->
            <a id="about" data-role="button" data-transition="slide"
            data-direction="reverse" href=
            "#page-about" data-icon="info" data-iconpos="left" class=
            "ui-btn-left">About</a>
    <!-- Search button -->
    <a data-role="button" id="search_page"
            data-transition="slide" href="#page-search" data-icon="search"
			data-iconpos="right" class="ui-btn-right">Raffina la ricerca</a>
            <h3><span id="titlebar"></span></h3>
        </div>

    <!-- Bounds Exceeded popup message -->
        <div data-role="popup" id="popupDialog" data-overlay-theme="a" data-theme="c"
         style="max-width:400px;" class="ui-corner-all">
            <div data-role="content" data-theme="d" class="ui-corner-bottom ui-content">
                <p id="alertMessageText"></p> 
                <a href="#page-map" id="alertMessageClose" data-role="button">OK</a>    
            </div>
        </div>

    <!-- The Map -->
        <div data-role="content" id="map_content" style="">
            <div id="map_canvas" style=
            "position:absolute;top:42px;bottom:42px;left:0px;right:0px;">
            </div>
        </div>

    <!-- Nearby button -->
        <div data-theme="a" data-role="footer" data-position="fixed"
        style="height:42px">
            <a id="nearby" data-role="button" href="#nearby" data-icon=
            "location" data-iconpos="left" class="ui-btn-left">
            <span id="nearby-name">Trovami</span></a>

    <!-- List button -->
            <a data-role="button" href="#page-list" data-icon="bars" id=
            "listview" data-transition="slideup" data-iconpos="right"
            class="ui-btn-right">Lista risultati</a>
        </div>
    </div>

    <!-- About view -->
    <div data-role="page" id="page-about">
        <div data-theme="a" data-role="header">
            <a data-role="button" data-transition="slide" data-icon="arrow-l" data-iconpos=
            "left" href="#page-map" class="ui-btn-left" id="about_back">Indietro</a>

            <h3>About</h3>
        </div>

        <div data-role="content" id="section-about">
        </div>
    </div>

    <!-- List view -->
    <div data-role="page" id="page-list">
        <div data-theme="a" data-role="header">
            <a data-role="button" data-direction="reverse"
            data-transition="slideup" href="index.html#page-map"
            data-icon="arrow-l" data-iconpos="left" class=
            "ui-btn-left" id="list_back">Indietro</a>

            <h3>Lista risultati</h3>
        </div>

        <div data-role="content">
            <ul data-role="listview" id="listview" data-divider-theme=""
            data-inset="false">
                <li data-theme="c">Caricamento dei risultati...</li>
            </ul>
        </div>
    </div>

    <!-- Search dialog -->
    <div data-role="page" id="page-search">
        <div data-theme="a" data-role="header">
            <a data-role="button" data-direction="reverse"
            data-transition="slide" href="index.html#page-map"
            data-icon="arrow-l" data-iconpos="left" class=
            "ui-btn-left" id="search_back">Indietro</a>

            <a data-role="button" href="index.html#page-map"
            data-icon="arrow-r" data-iconpos="right" class=
            "ui-btn-right" id="search_top">Effettua ricerca</a>
            <h3>Raffina la ricerca</h3>
        </div>

        <div data-role="content">
            <div id="section-search" data-role="fieldcontain"></div>
			<button class="btn" id="search" data-theme="b">Effettua ricerca</button>
			<button class="btn" id="search_reset" data-theme="r">Resetta Campi</button>
        </div>
    </div>

    <script type="text/javascript">
    $(function() {
        MapsLib.initialize();

        $("#about").click(function() { MapsLib.onExitMap(); });
        $("#search_page").click(function() { MapsLib.onExitMap(); });
        $("#listview").click(function(){
            MapsLib.onExitMap();
            MapsLib.getListView();
        });

        $("#about_back").click(function() { MapsLib.onEnterMap(); });
        $("#search_back").click(function() { MapsLib.onEnterMap(); });
        $("#list_back").click(function() { MapsLib.onEnterMap(); });

        $("#search").click(function(){
            MapsLib.onEnterMap();
            MapsLib.doSearch();
        });
        $("#search_top").click(function(){
            MapsLib.onEnterMap();
            MapsLib.doSearch();
        });
        $("#search_reset").click(function(){
            MapsLib.resetSearch();
        });
        window.addEventListener('popstate', function(e) { 
            MapsLib.onPopState();
        });
    });

	</script>
	
	<script type="text/javascript">
		$(document).on('change', 'select', function() {
			console.log($(this).val() + "	" + $(this).find("option:selected").text()); // the selected optionsâ€™s value
			if ($(this).val().indexOf("'ristoro'") !== -1 ) {
				console.log("Entrato nel caso ristoro");
				//label e dropdown relativi a ristoro appaiono
				slideToggleRistoroElements(false);
				//le altre label e contenitori di tipi specifici scompaiono
				slideToggleDivertimentoElements(true);
				slideToggleAperitivoElements(true);
				slideToggleAccoglienzaElements(true);
				slideToggleCucinaElements(true);
			} else if ($(this).val().indexOf("'ristorante'") !== -1 ) {
				console.log("Entrato nel caso tipi di cucina");
				//label e dropdown relativi a ristoro appaiono
				slideToggleCucinaElements(false);
				//le altre label e contenitori di tipi specifici scompaiono
				slideToggleDivertimentoElements(true);
				slideToggleAperitivoElements(true);
				slideToggleAccoglienzaElements(true);
			} else if ($(this).val().indexOf("'divertimento'") !== -1 ) {
				console.log("Entrato nel caso divertimento");
				//label e dropdown relativi a ristoro appaiono
				slideToggleDivertimentoElements(false);
				//le altre label e contenitori di tipi specifici scompaiono
				slideToggleRistoroElements(true);
				slideToggleAperitivoElements(true);
				slideToggleAccoglienzaElements(true);
				slideToggleCucinaElements(true);
			} else if ($(this).val().indexOf("'wine bar','cocktail bar','bar'") !== -1 ) {
				console.log("Entrato nel caso aperitivo");
				//label e dropdown relativi a ristoro appaiono
				slideToggleAperitivoElements(false);
				//le altre label e contenitori di tipi specifici scompaiono
				slideToggleRistoroElements(true);
				slideToggleDivertimentoElements(true);
				slideToggleAccoglienzaElements(true);
				slideToggleCucinaElements(true);
			} else if ($(this).val().indexOf("'accoglienza'") !== -1 ) {
				console.log("Entrato nel caso dove alloggiare");
				//label e dropdown relativi a ristoro appaiono
				slideToggleAccoglienzaElements(false);
				//le altre label e contenitori di tipi specifici scompaiono
				slideToggleRistoroElements(true);
				slideToggleDivertimentoElements(true);
				slideToggleAperitivoElements(true);
				slideToggleCucinaElements(true);
			} else if ($(this).val().indexOf("'discopub'") !== -1 || $(this).val().indexOf("'discoteca'") !== -1 
					|| $(this).val().indexOf("'italiana'") !== -1 || $(this).val().indexOf("'mediterranea'") !== -1
					|| $(this).val().indexOf("'pizza'") !== -1 || $(this).val().indexOf("'tipica'") !== -1
					|| $(this).val().indexOf("'tipica siciliana'") !== -1 || $(this).val().indexOf("'tipica palermitana'") !== -1
					|| $(this).val().indexOf("'internazionale'") !== -1 || $(this).val().indexOf("'europea'") !== -1
					|| $(this).val().indexOf("'spagnola'") !== -1 || $(this).val().indexOf("'fusion'") !== -1 
					|| $(this).find("option:selected").text() == "Qualunque tipo di divertimento"
					|| $(this).find("option:selected").text() == "Qualunque tipo di cucina") {
				console.log("Entrato nel caso dei nodi foglia");
				//do nothing
				
			} else if ($(this).val().indexOf("'pizzeria'") !== -1 || $(this).val().indexOf("'pub'") !== -1
					|| $(this).val().indexOf("'american bar'") !== -1 || $(this).val().indexOf("'sushi bar'") !== -1
					|| $(this).val().indexOf("'street food'") !== -1 || $(this).find("option:selected").text() == "Qualunque tipo di ristoro") {
				console.log("Entrato nel caso in cui la dropdown dei tipi di cucina deve essere chiusa");
				slideToggleCucinaElements(true);
			} else {
				console.log("Entrato nel caso dove gli altri elementi devono essere chiusi");
				//tutti gli elementi specifici vengono nascosti se viene
				//selezionato un tipo non specificato precedentemente
				slideToggleAccoglienzaElements(true);
				slideToggleRistoroElements(true);
				slideToggleDivertimentoElements(true);
				slideToggleAperitivoElements(true);
				slideToggleCucinaElements(true);
			}
		});
	</script>
	
	<script type="text/javascript">
		function slideToggleDivertimentoElements(visibility) {
			//se gli elementi sono visibili allora verranno nascosti, e viceversa
			if ($('#sc_Tipi_di_divertimento').closest('.ui-select').is(":visible") == visibility){
				$("label:contains('Tipi di divertimento:')").slideToggle();
				$('#sc_Tipi_di_divertimento').closest('.ui-select').slideToggle();
			}
			//setto i dropdown dei tipi specifici ai loro valori di default
			if ($('#sc_Tipi_di_divertimento').closest('.ui-select').is(":visible") == true) {
				$('#sc_Tipi_di_divertimento').find("option:selected").removeAttr("selected");
				$('#sc_Tipi_di_divertimento').selectmenu('refresh');
			}
		}
	</script>
	
	<script type="text/javascript">
		function slideToggleRistoroElements(visibility) {
			//se gli elementi sono visibili allora verranno nascosti, e viceversa
			if ($('#sc_Tipi_di_ristoro').closest('.ui-select').is(":visible") == visibility){
				$("label:contains('Tipi di ristoro:')").slideToggle();
				$('#sc_Tipi_di_ristoro').closest('.ui-select').slideToggle();
			//setto i dropdown dei tipi specifici ai loro valori di default
			if ($('#sc_Tipi_di_ristoro').closest('.ui-select').is(":visible") == true) {
				$('#sc_Tipi_di_ristoro').find("option:selected").removeAttr("selected");
				$('#sc_Tipi_di_ristoro').selectmenu('refresh');
			}
			}
		}
	</script>
	
	<script type="text/javascript">
		function slideToggleCucinaElements(visibility) {
			//se gli elementi sono visibili allora verranno nascosti, e viceversa
			if ($('#sc_Tipi_di_cucina').closest('.ui-select').is(":visible") == visibility){
				$("label:contains('Tipi di cucina:')").slideToggle();
				$('#sc_Tipi_di_cucina').closest('.ui-select').slideToggle();
			}
			//setto i dropdown dei tipi specifici ai loro valori di default
			if ($('#sc_Tipi_di_cucina').closest('.ui-select').is(":visible") == true) {
				$('#sc_Tipi_di_cucina').find("option:selected").removeAttr("selected");
				$('#sc_Tipi_di_cucina').selectmenu('refresh');
			}
		}
	</script>
	
	<script type="text/javascript">
		function slideToggleAperitivoElements(visibility) {
			//se gli elementi sono visibili allora verranno nascosti, e viceversa
			if ($("span:contains('Wine bar')").closest('.ui-checkbox').is(":visible") == visibility){
				$("span:contains('Wine bar')").closest('.ui-checkbox').slideToggle();
				$("span:contains('Cocktail bar')").closest('.ui-checkbox').slideToggle();
				$("span:contains('Bar')").closest('.ui-checkbox').slideToggle();
			}
			//setto le checkbox dei tipi specifici ai loro valori di default
			if ($("span:contains('Wine bar')").closest('.ui-checkbox').is(":visible") == true) {
				$('#sc_Wine_bar').prop('checked', false).checkboxradio("refresh");
				$('#sc_Cocktail_bar').prop('checked', false).checkboxradio("refresh");
				$('#sc_Bar').prop('checked', false).checkboxradio("refresh");
			}
		}
	</script>
	
	<script type="text/javascript">
		function slideToggleAccoglienzaElements(visibility) {
			//se gli elementi sono visibili allora verranno nascosti, e viceversa
			if ($("span:contains('Sale meeting')").closest('.ui-checkbox').is(":visible") == visibility){
				$("span:contains('Sale meeting')").closest('.ui-checkbox').slideToggle();
			}
			//setto le checkbox dei tipi specifici ai loro valori di default
			if ($("span:contains('Sale meeting')").closest('.ui-checkbox').is(":visible") == true) {
				$('#sc_Sale_meeting').prop('checked', false).checkboxradio("refresh");
			}
		}
	</script>

</body>
</html>
